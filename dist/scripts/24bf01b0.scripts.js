"use strict";angular.module("myApp",["ngCookies","ngResource","ngSanitize","ngRoute","LocalStorageModule"]).factory("Game",["$window","$rootScope","localStorageService",function(a,b,c){function d(){t=c.get("board"),u=g(),v=n(),w="It's Player "+(u+1)+"'s Turn!"}function e(a,b){p(a*b),h(0),c.add("isGameEnded",0);for(var d=a,e=b,f=[],g=0;e>g;g++){for(var i=[],k=0;d>k;k++)i.push("");f.push(i)}return w="Hello!!! It's Player "+(u+1)+"'s Turn!",j(f),t=f,f}function f(){return c.get("board")}function g(){return c.get("player")}function h(a){c.add("player",a),u=a}function i(){return w}function j(a){c.add("board",a)}function k(a){for(var b=t[a],c=0;c<b.length;c++)if(""==b[c]){t[a][c]=u?"X":"O",j(t),l([a,c]);break}}function l(a){o(),q(a)?(w="Player "+(u+1)+" wins!",c.add("isGameEnded",1)):0==v?(w="Draw!",c.add("isGameEnded",1)):m()}function m(){u=u?0:1,h(u),w="It's Player "+(u+1)+"'s Turn!"}function n(){c.get("spacesLeft")}function o(){v-=1,c.add("spacesLeft",v)}function p(a){v=a,c.add("spacesLeft",a)}function q(a){var b=a[0],c=a[1],d=t[b][c];return r(b,c,d)||s(b,c,d)?!0:!1}function r(a,b,c){for(var d=1;4>d;d++){var e=b-d;if(0>e||t[a][e]!=c)return!1}return!0}function s(a,b,c){for(var d=[-1,1,0],e=!1,f=0;3>f;f++){for(var g=d[f],h=1,i=1;4>i;i++){var j=a-i,k=b-g*i,l=0>j||0>k||j>=t.length||k>=t[0].length;if(l||t[j][k]!=c)break;h++}if(!(4>h)){e=!0;break}for(var i=1;4>i;i++){var j=a+i,k=b+g*i,l=0>j||0>k||j>=t.length||k>=t[0].length;if(l||t[j][k]!=c)break;if(h++,4==h){e=!0;break}}}return e}angular.element(a).on("storage",function(a){b.$broadcast("changeLocalstorage"),b.$apply()});var t=c.get("board"),u=g(),v=n(),w="It's Player "+(u+1)+"'s Turn!";return{createBoard:function(a,b){return e(a,b)},getBoard:function(){return f()},setBoard:function(a){return j(a)},getPlayer:function(){return g()},setPlayer:function(a){return h(a)},dropDisc:function(a){return k(a)},getStatus:function(){return i()},refreshBoard:function(){return d()},isGameEnded:function(){return c.get("isGameEnded")}}}]).filter("reverse",function(){return function(a){return a.slice().reverse()}}).config(["localStorageServiceProvider","$routeProvider",function(a,b){a.setPrefix("ls"),b.when("/games/:id",{templateUrl:"views/main.html",controller:"MaintCtrl"}).otherwise({redirectTo:"/games/1"})}]),angular.module("myApp").controller("MaintCtrl",["$rootScope","$scope","$routeParams","Game",function(a,b,c,d){function e(){g.builtBoard=d.createBoard(6,7)}function f(a,b){g.canPlay()&&""===g.builtBoard[a][b]&&(d.dropDisc(a),g.player=d.getPlayer(),g.builtBoard=d.getBoard(),g.gameStatus=d.getStatus())}var g=this,h=c.id;g.canPlay=function(){return h==d.getPlayer()+1&&!(1===g.isGameEnded)},g.builtBoard=d.getBoard(),g.player=d.getPlayer()||0,g.move=f,g.gameStatus=d.getStatus(),g.isGameEnded=d.isGameEnded(),g.createBoard=e,a.$on("changeLocalstorage",function(){d.refreshBoard(),g.player=d.getPlayer(),g.builtBoard=d.getBoard(),g.gameStatus=d.getStatus(),g.isGameEnded=d.isGameEnded()})}]);